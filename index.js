!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t){e.exports=require("mongoose")},function(e,t,s){const r=s(2),n=s(3);var o=s(4),d=(s(5),r()),a=process.env.PORT||1234;d.use(n.urlencoded({extended:!0})),d.use(n.json()),d.use(o({credentials:!0,origin:!0}));const i=s(6),u=s(0);u.Promise=global.Promise,u.connect(i.url,{useNewUrlParser:!0}).then(()=>{console.log("Successfully connected to the database")}).catch(e=>{console.log("Could not connect to the database. Exiting now...",e),process.exit()}),d.get("/",(e,t)=>{t.sendFile("index.html",{root:"."})}),s(7)(d),d.listen(a,()=>{console.log("Test API Server is listening on port "+a)})},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("path")},function(e,t){e.exports={url:"mongodb+srv://naveen:nvnkmr%40123@cluster0-r86wa.mongodb.net/afae?retryWrites=true&w=majority"}},function(e,t,s){"use strict";e.exports=(e=>{s(8)(e),s(10)(e)})},function(e,t,s){"use strict";var r=s(9);e.exports=(e=>{e.route("/heartbeat").get(r.get)})},function(e,t,s){"use strict";t.get=((e,t)=>{t.status(200).send({message:"API is alive."})})},function(e,t,s){"use strict";var r=s(11);e.exports=(e=>{e.post("/customer",r.create),e.get("/customers",r.findAll),e.get("/customer/:id",r.findOne),e.put("/customer/:id",r.update),e.delete("/customer/:id",r.delete),e.get("/customer/search/:text",r.search),e.put("/customer/pay/:id",r.pay),e.put("/customer/gift/:id",r.gift)})},function(e,t,s){"use strict";const r=s(12);var n=s(13);t.create=((e,t)=>{if(!e.body.fName||!e.body.mobileNo)return t.status(400).send({message:"Please fill all the required fields."});new r({number:e.body.number||"",fName:e.body.fName||"",lName:e.body.lName||"",mobileNo:e.body.mobileNo||"",email:e.body.email||"",agent:e.body.agent||"",address:e.body.address||"",giftModelNumber:e.body.giftModelNumber||"",giftName:e.body.giftName||"",giftAmount:e.body.giftAmount||0,isActive:!0,payment:[]}).save().then(e=>{t.send(e._id)}).catch(e=>{t.status(500).send({message:e.message||"Some error occurred while creating a record."})})}),t.findAll=((e,t)=>{r.find().then(e=>{t.send(e)}).catch(e=>{t.status(500).send({message:e.message||"Some error occurred while retrieving data."})})}),t.findOne=((e,t)=>{r.findById(e.params.id).then(s=>{if(!s)return t.status(404).send({message:"Record not found with id "+e.params.id});t.send(s)}).catch(s=>"ObjectId"===s.kind?t.status(404).send({message:"Record not found with id "+e.params.id}):t.status(500).send({message:"Error retrieving record with id "+e.params.id}))}),t.update=((e,t)=>{if(!e.body.fName||!e.body.mobileNo)return t.status(400).send({message:"Please fill all the required fields."});r.findByIdAndUpdate(e.params.id,{number:e.body.number||"",fName:e.body.fName||"",lName:e.body.lName||"",mobileNo:e.body.mobileNo||"",email:e.body.email||"",agent:e.body.agent||"",address:e.body.address||""},{new:!0}).then(s=>{if(!s)return t.status(404).send({message:"Record not found with id "+e.params.id});t.send(s._id)}).catch(s=>"ObjectId"===s.kind?t.status(404).send({message:"Record not found with id "+e.params.id}):t.status(500).send({message:"Error updating record with id "+e.params.id}))}),t.delete=((e,t)=>{r.findByIdAndRemove(e.params.id).then(s=>{if(!s)return t.status(404).send({message:"Record not found with id "+e.params.id});t.send({message:"Record deleted successfully!"})}).catch(s=>"ObjectId"===s.kind||"NotFound"===s.name?t.status(404).send({message:"Record not found with id "+e.params.id}):t.status(500).send({message:"Could not delete record with id "+e.params.id}))}),t.search=((e,t)=>{r.find({fName:new RegExp(e.params.text,"i")}).then(e=>{t.send(e)}).catch(e=>{t.status(500).send({message:e.message||"Some error occurred while retrieving records."})})}),t.pay=((e,t)=>{if(!e.params.id||!e.body.amount)return t.status(400).send({message:"Please fill all the required fields."});r.findById(e.params.id).then(s=>{if(!s)return t.status(404).send({message:"Record not found with id "+e.params.id});var o=s.payment,d=new Date;o||(o=[]),o.push({amount:e.body.amount,month:d.getMonth()+1,year:d.getFullYear(),isActive:!0,createdAt:d}),r.findByIdAndUpdate(e.params.id,{payment:o},{new:!0}).then(r=>{if(!r)return t.status(404).send({message:"Record not found with customerId "+e.params.id});var o=s.mobileNo,a="http://www.way2sms.com/api/v1/sendCampaign?apikey=50YXQL4SWR6EO3DQFD4UPOOVO5FBM2FN&secret=UPD6M6PAZJXH68A7&usetype=prod&senderid=AFAEGS&phone="+o+"&message="+("Your payment of amount Rs"+e.body.amount+" for Mega gift scheme in Andavar Furnitures and Electronics for Customer Number "+s.number+" is paid successfully on "+d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear()+".");console.log("TO:::",o),console.log("URL:::",a),n.get(a,(e,s,r)=>{r&&r.code&&"200"==r.code&&t.send({status:!0,smsStatus:!0}),console.log("body::: ",r),t.send({status:!0,smsStatus:!1})})}).catch(s=>"ObjectId"===s.kind?t.status(404).send({message:"Record not found with customerId "+e.params.id}):t.status(500).send({message:"Error updating record with customerId "+e.params.id}))}).catch(s=>"ObjectId"===s.kind?t.status(404).send({message:"Record not found with id "+e.params.id}):t.status(500).send({message:"Error retrieving record with id "+e.params.id}))}),t.gift=((e,t)=>{if(!(e.params.id&&e.body.modelNumber&&e.body.name&&e.body.amount))return t.status(400).send({message:"Please fill all the required fields."});r.findByIdAndUpdate(e.params.id,{giftModelNumber:e.body.modelNumber||"",giftName:e.body.name||"",giftAmount:e.body.amount||0},{new:!0}).then(s=>{if(!s)return t.status(404).send({message:"Record not found with customerId "+e.params.id});t.send({status:!0})}).catch(s=>"ObjectId"===s.kind?t.status(404).send({message:"Record not found with customerId "+e.params.id}):t.status(500).send({message:"Error updating record with customerId "+e.params.id}))})},function(e,t,s){const r=s(0),n=r.Schema({id:Number,number:String,fName:String,lName:String,mobileNo:String,email:String,agent:String,address:String,giftModelNumber:String,giftName:String,giftAmount:Number,isActive:Boolean,payment:[{amount:Number,month:Number,year:Number,isActive:Boolean,createdAt:Date}]},{timestamps:!0});e.exports=r.model("Customer",n)},function(e,t){e.exports=require("request")}]);